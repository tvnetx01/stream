<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jadwal TV SEA Games 2025</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --primary-color: #1a73e8;
            --secondary-color: #34a853;
            --accent-color: #fbbc05;
            --dark-color: #202124;
            --light-color: #f8f9fa;
            --border-color: #dadce0;
            --text-color: #3c4043;
            --text-light: #5f6368;
            --card-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            --hover-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }

        body {
            background-color: #f5f7fa;
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            padding: 1.5rem 0;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo i {
            font-size: 2.5rem;
            color: var(--accent-color);
        }

        .logo h1 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .logo span {
            color: var(--accent-color);
        }

        .last-updated {
            font-size: 0.9rem;
            opacity: 0.9;
            margin-top: 5px;
        }

        /* Kontrol */
        .controls {
            background-color: white;
            padding: 1.5rem;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            margin: 2rem 0;
        }

        .control-group {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            align-items: flex-end;
        }

        .date-control, .filter-control {
            flex: 1;
            min-width: 250px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--dark-color);
        }

        input, select {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 1rem;
            transition: border 0.3s;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(26, 115, 232, 0.2);
        }

        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn:hover {
            background-color: #0d62d9;
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .btn-secondary {
            background-color: var(--secondary-color);
        }

        .btn-secondary:hover {
            background-color: #2a8c47;
        }

        /* Stats */
        .stats {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 2rem;
        }

        .stat-card {
            background-color: white;
            padding: 1.2rem;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
            flex: 1;
            min-width: 200px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .stat-1 .stat-icon {
            background-color: rgba(26, 115, 232, 0.1);
            color: var(--primary-color);
        }

        .stat-2 .stat-icon {
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
        }

        .stat-3 .stat-icon {
            background-color: rgba(251, 188, 5, 0.1);
            color: var(--accent-color);
        }

        .stat-info h3 {
            font-size: 1.8rem;
            font-weight: 700;
        }

        .stat-info p {
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Jadwal */
        .schedule-section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 1.5rem;
            margin-bottom: 1.5rem;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--border-color);
            color: var(--dark-color);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .section-title i {
            color: var(--primary-color);
        }

        .channel-group {
            margin-bottom: 2rem;
        }

        .channel-header {
            background-color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px 8px 0 0;
            display: flex;
            align-items: center;
            gap: 15px;
            box-shadow: var(--card-shadow);
            border-left: 5px solid var(--primary-color);
        }

        .channel-logo {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .channel-name {
            font-size: 1.3rem;
            font-weight: 700;
        }

        .events-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }

        .event-card {
            background-color: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: transform 0.3s, box-shadow 0.3s;
            cursor: pointer;
            position: relative;
        }

        .event-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--hover-shadow);
        }

        .event-card:hover .watch-now {
            opacity: 1;
        }

        .event-time {
            background-color: var(--primary-color);
            color: white;
            padding: 12px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .live-indicator {
            background-color: #ea4335;
            color: white;
            padding: 3px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 5px;
        }

        .event-details {
            padding: 20px;
        }

        .event-title {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: var(--dark-color);
        }

        .event-sport {
            display: inline-block;
            background-color: rgba(52, 168, 83, 0.1);
            color: var(--secondary-color);
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            margin-bottom: 15px;
        }

        .event-desc {
            color: var(--text-light);
            font-size: 0.95rem;
            margin-bottom: 15px;
        }

        .event-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.85rem;
            color: var(--text-light);
        }

        .watch-now {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 0.8rem;
            opacity: 0;
            transition: opacity 0.3s;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        /* Modal untuk informasi stream */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }

        .modal-overlay.active {
            opacity: 1;
            visibility: visible;
        }

        .modal {
            background-color: white;
            border-radius: 10px;
            width: 90%;
            max-width: 500px;
            overflow: hidden;
            transform: translateY(-20px);
            transition: transform 0.3s;
        }

        .modal-overlay.active .modal {
            transform: translateY(0);
        }

        .modal-header {
            background-color: var(--primary-color);
            color: white;
            padding: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-header h3 {
            font-size: 1.3rem;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .close-modal {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.3s;
        }

        .close-modal:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 1.5rem;
        }

        .stream-info {
            margin-bottom: 1.5rem;
        }

        .stream-info p {
            margin-bottom: 0.5rem;
        }

        .stream-link {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .stream-link a {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            background-color: var(--secondary-color);
            color: white;
            padding: 12px;
            border-radius: 6px;
            text-decoration: none;
            font-weight: 600;
            transition: background-color 0.3s;
        }

        .stream-link a:hover {
            background-color: #2a8c47;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            background-color: #f8f9fa;
            border-top: 1px solid var(--border-color);
            text-align: center;
            color: var(--text-light);
            font-size: 0.9rem;
        }

        /* Footer */
        footer {
            background-color: var(--dark-color);
            color: white;
            padding: 2rem 0;
            margin-top: 3rem;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 30px;
        }

        .footer-section h3 {
            font-size: 1.2rem;
            margin-bottom: 15px;
            color: var(--accent-color);
        }

        .footer-section p, .footer-section a {
            color: #bdc1c6;
            margin-bottom: 8px;
            display: block;
            text-decoration: none;
        }

        .footer-section a:hover {
            color: white;
        }

        .copyright {
            text-align: center;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid #3c4043;
            color: #9aa0a6;
            font-size: 0.9rem;
        }

        /* Loading */
        .loading {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem;
            text-align: center;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(0, 0, 0, 0.1);
            border-radius: 50%;
            border-top-color: var(--primary-color);
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 1rem;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .control-group {
                flex-direction: column;
            }

            .date-control, .filter-control {
                min-width: 100%;
            }

            .events-container {
                grid-template-columns: 1fr;
            }

            .footer-content {
                flex-direction: column;
            }
        }

        /* Empty state */
        .empty-state {
            text-align: center;
            padding: 3rem;
            background-color: white;
            border-radius: 10px;
            box-shadow: var(--card-shadow);
        }

        .empty-state i {
            font-size: 3rem;
            color: var(--border-color);
            margin-bottom: 1rem;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">
                    <i class="fas fa-tv"></i>
                    <div>
                        <h1>Jadwal <span>SEA Games</span> 2025</h1>
                        <div class="last-updated">Memuat jadwal langsung dari mewatch.sg</div>
                    </div>
                </div>
                <div class="last-updated-info">
                    <div><i class="fas fa-sync-alt"></i> Terakhir diperbarui: <span id="last-updated-time">-</span></div>
                </div>
            </div>
        </div>
    </header>

    <main class="container">
        <!-- Kontrol -->
        <section class="controls">
            <div class="control-group">
                <div class="date-control">
                    <label for="date-select"><i class="far fa-calendar-alt"></i> Pilih Tanggal</label>
                    <input type="date" id="date-select" value="2025-12-03">
                </div>
                <div class="filter-control">
                    <label for="channel-filter"><i class="fas fa-filter"></i> Filter Saluran</label>
                    <select id="channel-filter">
                        <option value="all">Semua Saluran</option>
                    </select>
                </div>
                <div class="filter-control">
                    <label for="sport-filter"><i class="fas fa-running"></i> Filter Olahraga</label>
                    <select id="sport-filter">
                        <option value="all">Semua Olahraga</option>
                    </select>
                </div>
                <div>
                    <button class="btn" id="load-schedule">
                        <i class="fas fa-search"></i> Muat Jadwal
                    </button>
                    <button class="btn btn-secondary" id="reset-filters">
                        <i class="fas fa-redo"></i> Reset Filter
                    </button>
                </div>
            </div>
        </section>

        <!-- Stats -->
        <section class="stats">
            <div class="stat-card stat-1">
                <div class="stat-icon">
                    <i class="fas fa-broadcast-tower"></i>
                </div>
                <div class="stat-info">
                    <h3 id="total-channels">0</h3>
                    <p>Saluran</p>
                </div>
            </div>
            <div class="stat-card stat-2">
                <div class="stat-icon">
                    <i class="fas fa-calendar-day"></i>
                </div>
                <div class="stat-info">
                    <h3 id="total-events">0</h3>
                    <p>Acara Hari Ini</p>
                </div>
            </div>
            <div class="stat-card stat-3">
                <div class="stat-icon">
                    <i class="fas fa-futbol"></i>
                </div>
                <div class="stat-info">
                    <h3 id="total-sports">0</h3>
                    <p>Jenis Olahraga</p>
                </div>
            </div>
        </section>

        <!-- Loading State -->
        <section id="loading-section" class="loading hidden">
            <div class="spinner"></div>
            <h3>Memuat jadwal...</h3>
            <p>Harap tunggu sementara kami mengambil data dari server.</p>
        </section>

        <!-- Jadwal -->
        <section id="schedule-section" class="schedule-section">
            <h2 class="section-title"><i class="fas fa-list-alt"></i> Jadwal Acara</h2>
            
            <!-- Jadwal akan ditampilkan di sini -->
            <div id="schedule-container">
                <!-- Data akan dimasukkan oleh JavaScript -->
            </div>
        </section>

        <!-- Empty State -->
        <section id="empty-section" class="empty-state hidden">
            <i class="fas fa-calendar-times"></i>
            <h3>Tidak Ada Jadwal Tersedia</h3>
            <p>Tidak ada acara yang ditemukan untuk tanggal yang dipilih. Coba tanggal lain.</p>
        </section>
    </main>

    <!-- Modal Stream -->
    <div class="modal-overlay" id="stream-modal">
        <div class="modal">
            <div class="modal-header">
                <h3><i class="fas fa-play-circle"></i> Tonton Sekarang</h3>
                <button class="close-modal" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="stream-info">
                    <p><strong>Acara:</strong> <span id="modal-event-name">-</span></p>
                    <p><strong>Saluran:</strong> <span id="modal-channel-name">-</span></p>
                    <p><strong>Waktu:</strong> <span id="modal-event-time">-</span></p>
                    <p><strong>Stream ID:</strong> <span id="modal-axis-id">-</span></p>
                </div>
                <div class="stream-link">
                    <a href="#" id="stream-link" target="_blank">
                        <i class="fas fa-external-link-alt"></i> Buka Stream
                    </a>
                </div>
            </div>
            <div class="modal-footer">
                <p>Klik tombol di atas untuk membuka stream. Anda mungkin memerlukan aplikasi tertentu untuk memutar konten.</p>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>Jadwal SEA Games</h3>
                    <p>Situs web ini menampilkan jadwal siaran langsung SEA Games 2025 dari mewatch.sg.</p>
                    <p>Data diperbarui secara otomatis dari API resmi.</p>
                </div>
                <div class="footer-section">
                    <h3>Navigasi</h3>
                    <a href="#"><i class="fas fa-home"></i> Beranda</a>
                    <a href="#"><i class="fas fa-calendar-alt"></i> Jadwal</a>
                    <a href="#"><i class="fas fa-info-circle"></i> Tentang</a>
                </div>
                <div class="footer-section">
                    <h3>Kontak</h3>
                    <p><i class="fas fa-envelope"></i> info@seagames2025.com</p>
                    <p><i class="fas fa-phone"></i> +65 1234 5678</p>
                </div>
            </div>
            <div class="copyright">
                <p>&copy; 2025 Jadwal SEA Games. Data disediakan oleh mewatch.sg.</p>
            </div>
        </div>
    </footer>

    <script>
        // API Base URL
        const API_BASE_URL = 'https://apicollection.mewatch.sg/epg?date=';
        
        // Mapping axisId ke link stream
        const STREAM_MAPPING = {
            '576059': 'go:mwseag1',
            '576060': 'go:mwseag2', 
            '576062': 'go:mwseag3',
            '576063': 'go:mwseag4'
        };
        
        // Elemen DOM
        const dateSelect = document.getElementById('date-select');
        const channelFilter = document.getElementById('channel-filter');
        const sportFilter = document.getElementById('sport-filter');
        const loadScheduleBtn = document.getElementById('load-schedule');
        const resetFiltersBtn = document.getElementById('reset-filters');
        const scheduleContainer = document.getElementById('schedule-container');
        const loadingSection = document.getElementById('loading-section');
        const scheduleSection = document.getElementById('schedule-section');
        const emptySection = document.getElementById('empty-section');
        const lastUpdatedTime = document.getElementById('last-updated-time');
        const totalChannelsElement = document.getElementById('total-channels');
        const totalEventsElement = document.getElementById('total-events');
        const totalSportsElement = document.getElementById('total-sports');
        
        // Elemen modal
        const streamModal = document.getElementById('stream-modal');
        const closeModalBtn = document.getElementById('close-modal');
        const modalEventName = document.getElementById('modal-event-name');
        const modalChannelName = document.getElementById('modal-channel-name');
        const modalEventTime = document.getElementById('modal-event-time');
        const modalAxisId = document.getElementById('modal-axis-id');
        const streamLink = document.getElementById('stream-link');

        // Data global
        let epgData = [];
        let channels = [];
        let sports = [];
        let currentDate = '';

        // Format tanggal untuk API (YYYYMMDD)
        function formatDateForAPI(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const day = String(date.getDate()).padStart(2, '0');
            return `${year}${month}${day}`;
        }

        // Format tanggal untuk tampilan (DD/MM/YYYY)
        function formatDateForDisplay(dateString) {
            const date = new Date(dateString);
            const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
            return date.toLocaleDateString('id-ID', options);
        }

        // Format waktu untuk tampilan (HH:MM)
        function formatTimeForDisplay(dateString) {
            const date = new Date(dateString);
            const hours = String(date.getHours()).padStart(2, '0');
            const minutes = String(date.getMinutes()).padStart(2, '0');
            return `${hours}:${minutes}`;
        }

        // Dapatkan link stream berdasarkan axisId
        function getStreamLink(axisId) {
            return STREAM_MAPPING[axisId] || null;
        }

        // Tampilkan modal stream
        function showStreamModal(eventData) {
            const streamUrl = getStreamLink(eventData.axisId);
            
            if (!streamUrl) {
                alert('Stream tidak tersedia untuk acara ini.');
                return;
            }
            
            // Isi data modal
            modalEventName.textContent = eventData.eventName || eventData.syp || 'Tidak ada judul';
            modalChannelName.textContent = eventData.channelName || 'Tidak diketahui';
            modalEventTime.textContent = `${formatTimeForDisplay(eventData.startDate)} - ${formatTimeForDisplay(eventData.endDate)}`;
            modalAxisId.textContent = eventData.axisId;
            
            // Set link stream
            streamLink.href = streamUrl;
            
            // Tampilkan modal
            streamModal.classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        // Sembunyikan modal stream
        function hideStreamModal() {
            streamModal.classList.remove('active');
            document.body.style.overflow = 'auto';
        }

        // Tampilkan loading state
        function showLoading() {
            loadingSection.classList.remove('hidden');
            scheduleSection.classList.add('hidden');
            emptySection.classList.add('hidden');
        }

        // Sembunyikan loading state
        function hideLoading() {
            loadingSection.classList.add('hidden');
        }

        // Ambil data dari API
        async function fetchSchedule(date) {
            showLoading();
            const apiDate = formatDateForAPI(date);
            
            try {
                const response = await fetch(`${API_BASE_URL}${apiDate}`);
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching schedule:', error);
                alert('Gagal memuat jadwal. Silakan coba lagi nanti.');
                return null;
            }
        }

        // Proses data EPG
        function processEPGData(data) {
            if (!data || !data.epg || data.epg.length === 0) {
                return false;
            }

            epgData = data.epg;
            
            // Update waktu terakhir diperbarui
            if (data.lastUpdated) {
                const lastUpdated = new Date(data.lastUpdated);
                lastUpdatedTime.textContent = lastUpdated.toLocaleTimeString('id-ID', { 
                    hour: '2-digit', 
                    minute: '2-digit',
                    second: '2-digit'
                }) + ' WIB';
            }

            // Ekstrak daftar saluran unik
            channels = [...new Set(epgData.map(item => item.channelName))];
            
            // Ekstrak daftar olahraga unik
            sports = [...new Set(epgData.map(item => item.sport).filter(sport => sport && sport !== 'NA'))];
            
            // Update filter dropdown
            updateFilterDropdowns();
            
            // Update statistik
            updateStatistics();
            
            return true;
        }

        // Update dropdown filter
        function updateFilterDropdowns() {
            // Clear existing options except first
            while (channelFilter.options.length > 1) {
                channelFilter.remove(1);
            }
            
            while (sportFilter.options.length > 1) {
                sportFilter.remove(1);
            }
            
            // Add channel options
            channels.forEach(channel => {
                const option = document.createElement('option');
                option.value = channel;
                option.textContent = channel;
                channelFilter.appendChild(option);
            });
            
            // Add sport options
            sports.forEach(sport => {
                const option = document.createElement('option');
                option.value = sport;
                option.textContent = sport.charAt(0).toUpperCase() + sport.slice(1);
                sportFilter.appendChild(option);
            });
        }

        // Update statistik
        function updateStatistics() {
            // Hitung statistik
            const uniqueChannels = [...new Set(epgData.map(item => item.channelName))].length;
            const totalEvents = epgData.filter(item => item.sport !== 'NA').length;
            const uniqueSports = [...new Set(epgData.map(item => item.sport).filter(sport => sport && sport !== 'NA'))].length;
            
            // Update elemen statistik
            totalChannelsElement.textContent = uniqueChannels;
            totalEventsElement.textContent = totalEvents;
            totalSportsElement.textContent = uniqueSports;
        }

        // Render jadwal
        function renderSchedule() {
            // Dapatkan nilai filter
            const selectedChannel = channelFilter.value;
            const selectedSport = sportFilter.value;
            
            // Filter data berdasarkan pilihan
            let filteredData = epgData;
            
            if (selectedChannel !== 'all') {
                filteredData = filteredData.filter(item => item.channelName === selectedChannel);
            }
            
            if (selectedSport !== 'all') {
                filteredData = filteredData.filter(item => item.sport === selectedSport);
            }
            
            // Kelompokkan data berdasarkan saluran
            const groupedByChannel = {};
            filteredData.forEach(item => {
                if (!groupedByChannel[item.channelName]) {
                    groupedByChannel[item.channelName] = [];
                }
                groupedByChannel[item.channelName].push(item);
            });
            
            // Kosongkan kontainer
            scheduleContainer.innerHTML = '';
            
            // Cek jika tidak ada data
            if (Object.keys(groupedByChannel).length === 0) {
                scheduleSection.classList.add('hidden');
                emptySection.classList.remove('hidden');
                return;
            }
            
            // Tampilkan data yang dikelompokkan
            scheduleSection.classList.remove('hidden');
            emptySection.classList.add('hidden');
            
            for (const channelName in groupedByChannel) {
                const channelEvents = groupedByChannel[channelName];
                
                // Buat elemen grup saluran
                const channelGroup = document.createElement('div');
                channelGroup.className = 'channel-group';
                
                // Header saluran
                const channelHeader = document.createElement('div');
                channelHeader.className = 'channel-header';
                
                const channelLogo = document.createElement('div');
                channelLogo.className = 'channel-logo';
                channelLogo.textContent = channelName.substring(0, 2);
                
                const channelTitle = document.createElement('div');
                channelTitle.className = 'channel-name';
                channelTitle.textContent = channelName;
                
                channelHeader.appendChild(channelLogo);
                channelHeader.appendChild(channelTitle);
                
                // Kontainer acara
                const eventsContainer = document.createElement('div');
                eventsContainer.className = 'events-container';
                
                // Tambahkan setiap acara
                channelEvents.forEach(event => {
                    const eventCard = document.createElement('div');
                    eventCard.className = 'event-card';
                    
                    // Simpan data acara di atribut data
                    eventCard.dataset.axisId = event.axisId;
                    eventCard.dataset.eventName = event.eventName || event.syp;
                    eventCard.dataset.channelName = event.channelName;
                    eventCard.dataset.startDate = event.startDate;
                    eventCard.dataset.endDate = event.endDate;
                    
                    // Tambahkan event listener untuk klik
                    eventCard.addEventListener('click', () => {
                        showStreamModal(event);
                    });
                    
                    // Waktu acara
                    const eventTime = document.createElement('div');
                    eventTime.className = 'event-time';
                    
                    const timeRange = document.createElement('div');
                    timeRange.innerHTML = `<i class="far fa-clock"></i> ${formatTimeForDisplay(event.startDate)} - ${formatTimeForDisplay(event.endDate)}`;
                    
                    eventTime.appendChild(timeRange);
                    
                    // Tampilkan indikator LIVE jika ada
                    if (event.liveIndicator) {
                        const liveIndicator = document.createElement('div');
                        liveIndicator.className = 'live-indicator';
                        liveIndicator.innerHTML = '<i class="fas fa-circle"></i> LIVE';
                        eventTime.appendChild(liveIndicator);
                    }
                    
                    // Detail acara
                    const eventDetails = document.createElement('div');
                    eventDetails.className = 'event-details';
                    
                    const eventTitle = document.createElement('h3');
                    eventTitle.className = 'event-title';
                    eventTitle.textContent = event.eventName || event.syp;
                    
                    const eventSport = document.createElement('div');
                    eventSport.className = 'event-sport';
                    eventSport.innerHTML = `<i class="fas fa-${getSportIcon(event.sport)}"></i> ${event.sport || 'Acara'}`;
                    
                    const eventDesc = document.createElement('p');
                    eventDesc.className = 'event-desc';
                    eventDesc.textContent = event.programDescEnglish || 'Tidak ada deskripsi tersedia';
                    
                    const eventMeta = document.createElement('div');
                    eventMeta.className = 'event-meta';
                    
                    const eventLanguage = document.createElement('div');
                    eventLanguage.innerHTML = `<i class="fas fa-language"></i> ${event.programLanguage || 'Tidak diketahui'}`;
                    
                    const eventDuration = document.createElement('div');
                    const duration = calculateDuration(event.startDate, event.endDate);
                    eventDuration.innerHTML = `<i class="far fa-hourglass"></i> ${duration}`;
                    
                    eventMeta.appendChild(eventLanguage);
                    eventMeta.appendChild(eventDuration);
                    
                    // Tombol tonton sekarang
                    const watchNow = document.createElement('div');
                    watchNow.className = 'watch-now';
                    watchNow.innerHTML = '<i class="fas fa-play"></i> Tonton';
                    
                    eventDetails.appendChild(eventTitle);
                    eventDetails.appendChild(eventSport);
                    eventDetails.appendChild(eventDesc);
                    eventDetails.appendChild(eventMeta);
                    
                    eventCard.appendChild(watchNow);
                    eventCard.appendChild(eventTime);
                    eventCard.appendChild(eventDetails);
                    
                    eventsContainer.appendChild(eventCard);
                });
                
                channelGroup.appendChild(channelHeader);
                channelGroup.appendChild(eventsContainer);
                scheduleContainer.appendChild(channelGroup);
            }
        }

        // Hitung durasi acara
        function calculateDuration(startDate, endDate) {
            const start = new Date(startDate);
            const end = new Date(endDate);
            const durationMs = end - start;
            const durationHours = Math.floor(durationMs / (1000 * 60 * 60));
            const durationMinutes = Math.floor((durationMs % (1000 * 60 * 60)) / (1000 * 60));
            
            if (durationHours > 0) {
                return `${durationHours} jam ${durationMinutes} menit`;
            } else {
                return `${durationMinutes} menit`;
            }
        }

        // Dapatkan ikon untuk olahraga
        function getSportIcon(sport) {
            const sportIcons = {
                'football': 'futbol',
                'basketball': 'basketball-ball',
                'swimming': 'swimmer',
                'athletics': 'running',
                'tennis': 'tennis-ball',
                'badminton': 'table-tennis',
                'cycling': 'bicycle',
                'gymnastics': 'user-ninja',
                'volleyball': 'volleyball-ball',
                'boxing': 'boxing-glove'
            };
            
            return sportIcons[sport] || 'running';
        }

        // Muat jadwal untuk tanggal yang dipilih
        async function loadSchedule() {
            currentDate = dateSelect.value;
            
            // Update judul halaman dengan tanggal
            document.title = `Jadwal SEA Games - ${formatDateForDisplay(currentDate)}`;
            
            const data = await fetchSchedule(currentDate);
            
            if (data && processEPGData(data)) {
                renderSchedule();
            } else {
                scheduleSection.classList.add('hidden');
                emptySection.classList.remove('hidden');
            }
            
            hideLoading();
        }

        // Reset filter
        function resetFilters() {
            channelFilter.value = 'all';
            sportFilter.value = 'all';
            renderSchedule();
        }

        // Event Listeners
        loadScheduleBtn.addEventListener('click', loadSchedule);
        resetFiltersBtn.addEventListener('click', resetFilters);
        
        // Filter berubah
        channelFilter.addEventListener('change', renderSchedule);
        sportFilter.addEventListener('change', renderSchedule);
        
        // Modal events
        closeModalBtn.addEventListener('click', hideStreamModal);
        streamModal.addEventListener('click', (e) => {
            if (e.target === streamModal) {
                hideStreamModal();
            }
        });
        
        // Tutup modal dengan tombol ESC
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape' && streamModal.classList.contains('active')) {
                hideStreamModal();
            }
        });
        
        // Inisialisasi
        document.addEventListener('DOMContentLoaded', () => {
            // Set tanggal default ke hari ini
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(today.getDate() + 1);
            
            // Format tanggal untuk input type="date" (YYYY-MM-DD)
            const formattedDate = tomorrow.toISOString().split('T')[0];
            dateSelect.value = formattedDate;
            
            // Muat jadwal secara otomatis saat halaman dimuat
            loadSchedule();
        });
    </script>
</body>
</html>
