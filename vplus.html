<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VisionPlus Strip 17294 â€” Static Viewer</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--accent:#4f46e5;--live:#dc2626;--direct:#10b981}
    .dark{--bg:#0b1220;--card:#0f1724;--muted:#9ca3af;--accent:#7c3aed;--live:#ef4444;--direct:#34d399}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{background:var(--bg);color:var(--muted);padding:18px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{color:var(--card);font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .toggle{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:6px 10px;border-radius:999px;cursor:pointer}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px, 1fr));gap:14px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;flex-direction:column;cursor:pointer;transition:transform 0.2s, box-shadow 0.2s}
    .card:hover{transform:translateY(-4px);box-shadow:0 12px 24px rgba(2,6,23,0.1)}
    .card:active{transform:translateY(-2px)}
    .thumb{aspect-ratio:16/9;height:auto;width:100%;display:block;object-fit:cover;background:#111;}
    .card-body{padding:12px;flex:1;display:flex;flex-direction:column}
    .title{font-weight:700;color:var(--muted);font-size:14px;margin:0 0 6px}
    .meta{font-size:12px;color:var(--muted);line-height:1.25}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .small{font-size:12px;color:var(--muted)}
    .badges{display:flex;gap:4px;margin-top:8px;flex-wrap:wrap}
    .badge-live{background:var(--live);color:#fff;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase}
    .badge-direct{background:var(--direct);color:#fff;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase}
    .badge-default{background:var(--accent);color:#fff;padding:4px 8px;border-radius:6px;font-size:10px;font-weight:700;text-transform:uppercase}

    .muted-note{font-size:13px;color:var(--muted);margin-top:10px}
    .error{color:#ff4d4f}
    
    /* Animasi Loading */
    .loading-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: var(--bg);
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      transition: opacity 0.3s ease-out, visibility 0.3s ease-out;
    }
    
    .loading-overlay.hidden {
      opacity: 0;
      visibility: hidden;
    }
    
    .loading-spinner {
      width: 50px;
      height: 50px;
      border: 4px solid rgba(79, 70, 229, 0.2);
      border-radius: 50%;
      border-top-color: var(--accent);
      animation: spin 1s ease-in-out infinite;
      margin-bottom: 20px;
    }
    
    .loading-text {
      color: var(--muted);
      font-size: 16px;
      font-weight: 500;
      animation: pulse 1.5s ease-in-out infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 0.6; }
      50% { opacity: 1; }
    }
    
    /* Skeleton Loading untuk card */
    .skeleton-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 14px;
      margin-top: 12px;
    }
    
    .skeleton-card {
      background: var(--card);
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 6px 18px rgba(2,6,23,0.06);
      animation: skeleton-loading 1.5s ease-in-out infinite;
    }
    
    .skeleton-thumb {
      aspect-ratio: 16/9;
      width: 100%;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton-gradient 1.5s ease-in-out infinite;
    }
    
    .skeleton-body {
      padding: 12px;
    }
    
    .skeleton-title {
      height: 16px;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton-gradient 1.5s ease-in-out infinite;
      border-radius: 4px;
      margin-bottom: 8px;
    }
    
    .skeleton-meta {
      height: 12px;
      width: 70%;
      background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
      background-size: 200% 100%;
      animation: skeleton-gradient 1.5s ease-in-out infinite;
      border-radius: 4px;
    }
    
    .dark .skeleton-thumb,
    .dark .skeleton-title,
    .dark .skeleton-meta {
      background: linear-gradient(90deg, #1a2236 25%, #222d44 50%, #1a2236 75%);
      background-size: 200% 100%;
    }
    
    @keyframes skeleton-gradient {
      0% { background-position: 200% 0; }
      100% { background-position: -200% 0; }
    }
    
    @keyframes skeleton-loading {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }

    @media (prefers-color-scheme: dark){body{background:var(--bg);color:var(--muted)}}
  </style>
   <script type="text/javascript" src="//zoologicalmanufacture.com/fb/a9/c9/fba9c97905a9e38bdcfc4dfd23ee50d8.js"></script>
<script src='https://pisionx.pages.dev/dazn.js'></script>

</head>
<body>
  <div class="container" id="app">
    <!-- Loading Overlay -->
    <div id="loadingOverlay" class="loading-overlay">
      <div class="loading-spinner"></div>
      <div class="loading-text">Memuat data NETXTV...</div>
    </div>
    
    <header>
      <div class="controls">
        <button id="liveFilterBtn" class="toggle">NETXTV X VISION+</button>
        <button id="darkToggle" class="btn">Dark</button>
      </div>
    </header>

    <main>
      <!-- Skeleton Loading untuk grid -->
      <div id="skeletonGrid" class="skeleton-grid" style="margin-top:12px">
        <!-- Skeleton cards akan dibuat secara dinamis -->
      </div>
      
      <!-- Grid asli (awalnya tersembunyi) -->
      <div id="grid" class="grid" style="margin-top:12px; display: none;"></div>
      <div id="empty" class="muted-note" style="display:none;margin-top:18px">Tidak ada item ditemukan.</div>
    </main>
  </div>

  <script>
    (function(){
      const API_URL = 'https://www.visionplus.id/elements/strips/17294?language=IND&partition=IndonesiaPartition&renderVersion=110005&target=WEB&version=5a4a49113c28145c5d5b2c061b8b1ece';
      const app = document.getElementById('app');
      const grid = document.getElementById('grid');
      const skeletonGrid = document.getElementById('skeletonGrid');
      const loadingOverlay = document.getElementById('loadingOverlay');
      const empty = document.getElementById('empty');
      const liveFilterBtn = document.getElementById('liveFilterBtn');
      const darkToggle = document.getElementById('darkToggle');

      let items = [];
      let filterLive = false;
      let dark = false;

      // Mapping channelServiceId ke direct play URLs
      const CHANNEL_MAPPING = {
        "00000000000000001019": "go:vpseag1",
        "00000000000000001020": "go:vpseag2", 
        "00000000000000001021": "go:vpseag3",
        "00000000000000001022": "go:vpseag4"
      };

      // Fungsi untuk menampilkan loading
      function showLoading() {
        loadingOverlay.classList.remove('hidden');
        skeletonGrid.style.display = 'grid';
        grid.style.display = 'none';
        
        // Buat skeleton cards
        skeletonGrid.innerHTML = '';
        for (let i = 0; i < 8; i++) {
          const skeletonCard = document.createElement('div');
          skeletonCard.className = 'skeleton-card';
          
          skeletonCard.innerHTML = `
            <div class="skeleton-thumb"></div>
            <div class="skeleton-body">
              <div class="skeleton-title"></div>
              <div class="skeleton-meta"></div>
            </div>
          `;
          
          skeletonGrid.appendChild(skeletonCard);
        }
      }

      // Fungsi untuk menyembunyikan loading
      function hideLoading() {
        // Animasi fade out pada overlay
        loadingOverlay.classList.add('hidden');
        
        // Tunggu sebentar sebelum menyembunyikan skeleton dan menampilkan grid
        setTimeout(() => {
          skeletonGrid.style.display = 'none';
          grid.style.display = 'grid';
        }, 300);
      }

      function buildImageUrl(loc){
        if(!loc) return null;
        try{
          if(loc.imgLnks && loc.imgLnks.sizes && loc.imgLnks.sizes.l){
            return 'https://www.visionplus.id/images/repository/' + loc.imgLnks.sizes.l;
          }
          if(loc.images && loc.images.url){
            return 'https://www.visionplus.id/' + loc.images.url.replace('{image-size}','l');
          }
        }catch(e){ }
        return null;
      }

      function buildSelectUrl(select){
        if(!select) return null;
        const params = select.params || {};
        const base = select.url || '';
        const query = new URLSearchParams(params).toString();
        const prefixed = base.startsWith('http') ? base : ('https://www.visionplus.id' + base);
        return query ? (prefixed + '?' + query) : prefixed;
      }

      // Fungsi untuk mendapatkan direct play URL berdasarkan channelServiceId
      function getDirectPlayUrl(channelServiceId) {
        if (!channelServiceId) return null;
        return CHANNEL_MAPPING[channelServiceId] || null;
      }

      function parseItems(json){
        const nodes = json.nodes || [];
        return nodes.map(n => {
          const loc = (n.display && n.display.localisation && n.display.localisation[0]) || {};
          const delivery = (n.additional && n.additional.deliveries && n.additional.deliveries[0]) || {};
          const channelServiceId = delivery.channelServiceId || null;
          const directPlayUrl = getDirectPlayUrl(channelServiceId);
          const selectUrl = buildSelectUrl(n.interaction && n.interaction.select);
          
          // Tentukan URL yang akan digunakan saat card diklik
          // Prioritas: directPlayUrl > selectUrl
          const clickUrl = directPlayUrl || selectUrl;
          const clickType = directPlayUrl ? 'direct' : (selectUrl ? 'default' : 'none');
          
          return {
            ordinal: n.ordinal,
            title: (loc.contentTitle || loc.title || '').trim() || 'Untitled',
            subtitle: loc.subtitle || '',
            image: buildImageUrl(loc),
            selectUrl: selectUrl,
            broadcastStart: delivery.broadcastStart || null,
            broadcastEnd: delivery.broadcastEnd || null,
            resolution: delivery.resolution || null,
            channelServiceId: channelServiceId,
            directPlayUrl: directPlayUrl,
            clickUrl: clickUrl,
            clickType: clickType
          };
        });
      }

      function isLive(it){
        if(!it.broadcastStart || !it.broadcastEnd) return false;
        const now = new Date();
        const s = new Date(it.broadcastStart);
        const e = new Date(it.broadcastEnd);
        return now >= s && now <= e;
      }

      function fmtLocal(dtStr){
        if(!dtStr) return '-';
        try{
          const d = new Date(dtStr);
          return new Intl.DateTimeFormat('id-ID', { 
            timeZone: 'Asia/Jakarta', 
            year:'numeric', 
            month:'short', 
            day:'numeric', 
            hour:'2-digit', 
            minute:'2-digit', 
            hour12:false 
          }).format(d);
        }catch(e){ return dtStr; }
      }

      // Fungsi untuk menangani klik pada card
      function handleCardClick(item) {
        if (!item.clickUrl) {
          return; // Tidak ada URL, tidak melakukan apa-apa
        }
        
        if (item.clickType === 'direct') {
          // Untuk link "go:" (deep link VisionPlus)
          // Langsung buka deep link tanpa alert fallback
          window.location.href = item.clickUrl;
        } else {
          // Untuk URL biasa, buka di tab baru
          window.open(item.clickUrl, '_blank');
        }
      }

      function render(){
        grid.innerHTML = '';
        const visible = items.filter(it => (filterLive ? isLive(it) : true));
        
        if(visible.length === 0){ 
          empty.style.display = 'block'; 
          grid.style.display = 'none';
        } else { 
          empty.style.display = 'none'; 
          grid.style.display = 'grid';
        }
        
        visible.forEach(it => {
          const card = document.createElement('article');
          card.className = 'card';
          
          // Tambahkan event click pada seluruh card
          card.onclick = () => handleCardClick(it);
          
          // Tambahkan title attribute untuk info hover
          if (it.clickType === 'direct') {
            card.title = `Klik untuk Direct Play: ${it.directPlayUrl}`;
          } else if (it.clickType === 'default') {
            card.title = 'Klik untuk membuka halaman detail';
          }

          const img = document.createElement('img');
          img.className = 'thumb';
          img.src = it.image || 'https://via.placeholder.com/800x450?text=No+Image';
          img.alt = it.title;
          img.onerror = () => { img.src = 'https://via.placeholder.com/800x450?text=No+Image'; };

          const body = document.createElement('div');
          body.className = 'card-body';

          const h = document.createElement('h3'); 
          h.className='title'; 
          h.textContent = it.title;
          
          const meta = document.createElement('div'); 
          meta.className='meta';
          meta.innerHTML = `<div>${fmtLocal(it.broadcastStart)}</div>`;

          // Badges untuk menampilkan status
          const badges = document.createElement('div');
          badges.className = 'badges';
          
          if (isLive(it)) {
            const liveBadge = document.createElement('span');
            liveBadge.className = 'badge-live';
            liveBadge.textContent = 'LIVE';
            badges.appendChild(liveBadge);
          }
          
          if (it.clickType === 'direct') {
            const directBadge = document.createElement('span');
            directBadge.className = 'badge-direct';
            directBadge.textContent = 'WATCH NOW!';
            badges.appendChild(directBadge);
          } else if (it.clickType === 'default') {
            const defaultBadge = document.createElement('span');
            defaultBadge.className = 'badge-default';
            defaultBadge.textContent = 'DETAIL';
            badges.appendChild(defaultBadge);
          }

          body.appendChild(h); 
          body.appendChild(meta);
          body.appendChild(badges);

          card.appendChild(img); 
          card.appendChild(body);
          grid.appendChild(card);
        });
      }

      liveFilterBtn.addEventListener('click', () => {
        filterLive = !filterLive;
        liveFilterBtn.textContent = filterLive ? 'Tampilkan: LIVE saja' : 'Tampilkan: Semua';
        render();
      });

      darkToggle.addEventListener('click', () => {
        dark = !dark;
        document.documentElement.classList.toggle('dark', dark);
        darkToggle.textContent = dark ? 'Light' : 'Dark';
      });

      async function load(){
        try{
          // Tampilkan loading sebelum memulai fetch
          showLoading();
          
          const r = await fetch(API_URL);
          if(!r.ok) throw new Error('HTTP ' + r.status);
          const j = await r.json();
          items = parseItems(j);
          
          // Simulasikan loading sedikit lebih lama untuk efek yang lebih baik
          setTimeout(() => {
            render();
            hideLoading();
          }, 500);
          
        }catch(err){
          hideLoading();
          alert('Error: ' + err.message);
          console.error('Error loading data:', err);
        }
      }

      // Mulai loading saat halaman dimuat
      load();
    })();
  </script>
</body>
</html>
