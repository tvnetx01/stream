<!doctype html>
<html lang="id">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>VisionPlus Strip 17294 — Static Viewer</title>
  <style>
    :root{--bg:#f6f7fb;--card:#fff;--muted:#6b7280;--accent:#4f46e5;--live:#dc2626}
    .dark{--bg:#0b1220;--card:#0f1724;--muted:#9ca3af;--accent:#7c3aed;--live:#ef4444}
    html,body{height:100%;margin:0;font-family:Inter,ui-sans-serif,system-ui,-apple-system,'Segoe UI',Roboto,'Helvetica Neue',Arial}
    body{background:var(--bg);color:var(--muted);padding:18px}
    .container{max-width:1100px;margin:0 auto}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:18px}
    h1{color:var(--card);font-size:20px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    .btn{background:var(--accent);color:#fff;padding:8px 12px;border-radius:10px;border:0;cursor:pointer;font-weight:600}
    .toggle{background:transparent;border:1px solid rgba(255,255,255,0.06);color:var(--muted);padding:6px 10px;border-radius:999px;cursor:pointer}

    .grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:14px}
    .card{background:var(--card);border-radius:12px;overflow:hidden;box-shadow:0 6px 18px rgba(2,6,23,0.06);display:flex;flex-direction:column}
    .thumb{height:140px;background:#111;display:block;object-fit:cover;width:100%}
    .card-body{padding:12px;flex:1;display:flex;flex-direction:column}
    .title{font-weight:700;color:var(--muted);font-size:14px;margin:0 0 6px}
    .meta{font-size:12px;color:var(--muted);line-height:1.25}
    .row{display:flex;justify-content:space-between;align-items:center;margin-top:10px}
    .small{font-size:12px;color:var(--muted)}
    .play{background:transparent;border:1px solid rgba(0,0,0,0.06);padding:6px 10px;border-radius:8px;cursor:pointer}
    .badge-live{background:var(--live);color:#fff;padding:6px 8px;border-radius:8px;font-size:12px;font-weight:700}

    .muted-note{font-size:13px;color:var(--muted);margin-top:10px}
    .error{color:#ff4d4f}

    @media (prefers-color-scheme: dark){body{background:var(--bg);color:var(--muted)}}
  </style>
</head>
<body>
  <div class="container" id="app">
    <header>
      <div>
        <h1>VisionPlus — Strip 17294</h1>
        <div class="muted-note">Menampilkan jadwal &amp; thumbnail. Zona waktu tampilan: Asia/Makassar</div>
      </div>

      <div class="controls">
        <button id="liveFilterBtn" class="toggle">Tampilkan: Semua</button>
        <button id="darkToggle" class="btn">Dark</button>
      </div>
    </header>

    <main>
      <div id="status" class="muted-note">Memuat…</div>
      <div id="grid" class="grid" style="margin-top:12px"></div>
      <div id="empty" class="muted-note" style="display:none;margin-top:18px">Tidak ada item ditemukan.</div>
    </main>

    <footer style="margin-top:20px;color:var(--muted);font-size:13px">Sumber: <a href="https://www.visionplus.id" target="_blank">visionplus.id</a></footer>
  </div>

  <script>
    (function(){
      const API_URL = 'https://www.visionplus.id/elements/strips/17294?language=IND&partition=IndonesiaPartition&renderVersion=110005&target=WEB&version=5a4a49113c28145c5d5b2c061b8b1ece';
      const app = document.getElementById('app');
      const grid = document.getElementById('grid');
      const status = document.getElementById('status');
      const empty = document.getElementById('empty');
      const liveFilterBtn = document.getElementById('liveFilterBtn');
      const darkToggle = document.getElementById('darkToggle');

      let items = [];
      let filterLive = false;
      let dark = false;

      function setStatus(t){ status.textContent = t; }

      function buildImageUrl(loc){
        if(!loc) return null;
        // prefer imgLnks.sizes.l
        try{
          if(loc.imgLnks && loc.imgLnks.sizes && loc.imgLnks.sizes.l){
            return 'https://www.visionplus.id/images/repository/' + loc.imgLnks.sizes.l;
          }
          if(loc.images && loc.images.url){
            return 'https://www.visionplus.id/' + loc.images.url.replace('{image-size}','l');
          }
        }catch(e){ }
        return null;
      }

      function buildSelectUrl(select){
        if(!select) return null;
        const params = select.params || {};
        const base = select.url || '';
        const query = new URLSearchParams(params).toString();
        const prefixed = base.startsWith('http') ? base : ('https://www.visionplus.id' + base);
        return query ? (prefixed + '?' + query) : prefixed;
      }

      function parseItems(json){
        const nodes = json.nodes || [];
        return nodes.map(n => {
          const loc = (n.display && n.display.localisation && n.display.localisation[0]) || {};
          const delivery = (n.additional && n.additional.deliveries && n.additional.deliveries[0]) || {};
          return {
            ordinal: n.ordinal,
            title: (loc.contentTitle || loc.title || '').trim() || 'Untitled',
            subtitle: loc.subtitle || '',
            image: buildImageUrl(loc),
            selectUrl: buildSelectUrl(n.interaction && n.interaction.select),
            broadcastStart: delivery.broadcastStart || null,
            broadcastEnd: delivery.broadcastEnd || null,
            resolution: delivery.resolution || null
          };
        });
      }

      function isLive(it){
        if(!it.broadcastStart || !it.broadcastEnd) return false;
        const now = new Date();
        const s = new Date(it.broadcastStart);
        const e = new Date(it.broadcastEnd);
        return now >= s && now <= e;
      }

      function fmtLocal(dtStr){
        if(!dtStr) return '-';
        try{
          const d = new Date(dtStr);
          return new Intl.DateTimeFormat('id-ID', { timeZone: 'Asia/Makassar', year:'numeric', month:'short', day:'numeric', hour:'2-digit', minute:'2-digit', hour12:false }).format(d);
        }catch(e){ return dtStr; }
      }

      function render(){
        grid.innerHTML = '';
        const visible = items.filter(it => (filterLive ? isLive(it) : true));
        if(visible.length === 0){ empty.style.display = 'block'; } else { empty.style.display = 'none'; }
        visible.forEach(it => {
          const card = document.createElement('article');
          card.className = 'card';

          const img = document.createElement('img');
          img.className = 'thumb';
          img.src = it.image || 'https://via.placeholder.com/800x450?text=No+Image';
          img.alt = it.title;
          img.onerror = () => { img.src = 'https://via.placeholder.com/800x450?text=No+Image'; };

          const body = document.createElement('div');
          body.className = 'card-body';

          const h = document.createElement('h3'); h.className='title'; h.textContent = it.title;
          const meta = document.createElement('div'); meta.className='meta';
          meta.innerHTML = `<div>Start: ${fmtLocal(it.broadcastStart)}</div><div>End: ${fmtLocal(it.broadcastEnd)}</div><div>Res: ${it.resolution || '-'}</div>`;

          const row = document.createElement('div'); row.className='row';
          const play = document.createElement('button'); play.className='play'; play.textContent = 'Play';
          play.onclick = () => { if(it.selectUrl) window.open(it.selectUrl, '_blank'); else alert('No URL available'); };

          const right = document.createElement('div');
          right.style.display='flex'; right.style.alignItems='center'; right.style.gap='8px';

          if(isLive(it)){ const b=document.createElement('span'); b.className='badge-live'; b.textContent='LIVE'; right.appendChild(b);} 

          const imgLink = document.createElement('a'); imgLink.href = it.image || '#'; imgLink.target='_blank'; imgLink.rel='noreferrer'; imgLink.className='small'; imgLink.textContent='Open Image';
          right.appendChild(imgLink);

          row.appendChild(play); row.appendChild(right);

          body.appendChild(h); body.appendChild(meta); body.appendChild(row);

          card.appendChild(img); card.appendChild(body);
          grid.appendChild(card);
        });
      }

      liveFilterBtn.addEventListener('click', () => {
        filterLive = !filterLive;
        liveFilterBtn.textContent = filterLive ? 'Tampilkan: LIVE saja' : 'Tampilkan: Semua';
        render();
      });

      darkToggle.addEventListener('click', () => {
        dark = !dark;
        document.documentElement.classList.toggle('dark', dark);
        darkToggle.textContent = dark ? 'Light' : 'Dark';
      });

      async function load(){
        try{
          setTimeout(()=>setStatus('Memuat data dari API...'),0);
          const r = await fetch(API_URL);
          if(!r.ok) throw new Error('HTTP ' + r.status);
          const j = await r.json();
          items = parseItems(j);
          setStatus('Selesai. Menampilkan ' + items.length + ' item.');
          render();
        }catch(err){
          setStatus('Error: ' + err.message);
          status.classList.add('error');
        }
      }

      load();
    })();
  </script>
</body>
</html>
